<!DOCTYPE html>

<html lang="en">
    <head>
        <title>Preceptor</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js"></script>
        <style>
            body {
                padding-top: 40px;
            }

            ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
                width: 11.4%;
                background-color: #ffff99;
                position: fixed;
                height: 100%;
                overflow: auto;
            }

            li a {
                display: block;
                color: #000;
                padding: 8px 16px;
                text-decoration: none;
            }

            li a.active {
                background-color: #4CAF50;
                color: white;
            }

            li a:hover:not(.active) {
                background-color: #555;
                color: white;
            }

            .navbar {
                overflow: hidden;
                background-color: #333;
                position: fixed;
                top: 0;
                width: 100%;
            }

            .navbar a {
                float: left;
                display: block;
                color: #f2f2f2;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
                font-size: 17px;
            }

            .main {
                padding: 16px;
                margin-top: 30px;
                height: 1500px; /* Used in this example to enable scrolling */
            }

        </style>
    </head>
    <body>

        <div class="navbar">
            <a href="#">{{user}}</a>
            <a style="float:right" href="{% url 'logout_p' %}">Salir</a>
        </div>

        <ul>
            <li><a id="mis_alumnos" href="#home">Mis Alumnos</a></li>
            <li><a id="crear_formularios" href="#">Crear Formulario</a></li>
            <li><a id="mis_formularios" href="#">Ver Formularios</a></li>
            <li><a id="charts" href="#">Datos</a></li>
            <li><a id="asistencia" href="#">Asistencia</a></li>
        </ul>

        

        <div id="contenido">
        </div>
        
        <div id="toast"></div>

        <div id="id02" class="w3-modal">
            <div class="modal-dialog modal-sm" id="datos2">
            </div>
        </div>



        <div class="modal fade bd-example-modal-sm" id="datos" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria hidden="true">
            <div class="modal-dialog modal-sm"></div>
        </div>

    </body>

    <script type="text/javascript">
        $(document).ready(function(){
            $('#mis_alumnos').click(function(){
                $.ajax({
                    method: "GET",
                    url: "/mis_alumnos/",
                })
                    .done(function(data){
                    $("#contenido")[0].innerHTML = data;
                });
            });
            $('#mis_formularios').click(function(){
                $.ajax({
                    method: "GET",
                    url: "/mis_formularios/",
                })
                    .done(function(data){
                    $("#contenido")[0].innerHTML = data;
                });
            });
            $('#crear_formularios').click(function(){
                $.ajax({
                    method: "GET",
                    url: "/mis_alumnos_presentes/",
                })
                    .done(function(data){
                    $("#contenido")[0].innerHTML = data;
                });
            });
            $('#asistencia').click(function(){
                $.ajax({
                    method: "GET",
                    url: "/faltas/",
                })
                    .done(function(data){
                    $("#contenido")[0].innerHTML = data;
                });
            });
            $('#charts').click(function(){
                $.ajax({
                    method: "GET",
                    url: "/estadisticas_alumno/",
                })
                    .done(function(datos){
                    new Chart(document.getElementById("chart1"), 
                              {
                        height: 260,
                        type: 'horizontalBar',
                        data: {
                            labels: ["Presentes", "Ausentes", "Retirados"],
                            datasets: [
                                {
                                    label: "Cantidad",
                                    backgroundColor: ["#3e95cd", "#ff6347","#585858"],
                                    data: [datos.presente,datos.ausente,datos.saliendo],
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            legend: { display: false },
                            title: {
                                fontSize: 35,
                                display: true,
                                text: 'Alumnos'
                            }
                        }
                    })

                    new Chart(document.getElementById("chart2"), 
                              {
                        type: 'pie',
                        data: {
                            labels: ["Presentes", "Ausentes", "Retirados"],
                            datasets: [
                                {
                                    label: "Cantidad",
                                    backgroundColor: ["#3e95cd", "#ff6347","#585858"],
                                    data: [datos.presente,datos.ausente,datos.saliendo],
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            legend: { display: false },
                            title: {
                                fontSize: 35,
                                display: true,
                                text: 'Alumnos'
                            }
                        }
                    })
                })
            });
        });
    </script>
    <script>
        function traer(url, alum) {
            //alert("soquetes");
            $.ajax({
                method: "POST",
                url: url,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            })
                .done(function (data) {
                $("#datos").html(data);
                document.getElementById('id01').style.display='block';
            });
        };


        function cerrar() {
            var modal = document.getElementById('id01');
            modal.style.display = "none";
        }

        function pres(url, alum) {
            $.ajax({
                method: "POST",
                url: url,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            })
                .done(function (data) {
                $("#datos").html(data);
                $('#datos').modal('show');

            });
        };

        function crear_formulario(url, alum) {
            console.log("entro");
            $.ajax({
                method: "POST",
                url: url,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            })
                .done(function (data) {
                $('#datos').modal('hide');
                var x=document.getElementById("toast");
                x.classList.add("show");
                x.innerHTML="Creado";
                setTimeout(function(){
                    x.classList.remove("show");
                },3000);
            });  
        };

        function datos_formulario_preceptor(url, formu) {
            $.ajax({
                method: "POST",
                url: url,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            })
                .done(function (data) {
                $("#datos2").html(data);
                document.getElementById('id02').style.display='block';
            });
        };

        function datos_formulario(url, formu) {
            alert(formu);
            $.ajax({
                method: "POST",
                url: url,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            })
                .done(function (data) {
                $("#datos2").html(data);
                document.getElementById('id02').style.display='block';
            });
        };
    </script>
</html>
